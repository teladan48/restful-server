language: php
php:
  - '5.6'

before_install:
  - composer self-update
  - composer config --global github-oauth.github.com $GITHUB_TOKEN
  - mkdir ~/.ssh
  - echo "$SSH_PRIVATE" > ~/.ssh/id_rsa
  - chmod 600 ~/.ssh/id_rsa

install:
  - composer install --prefer-dist --no-interaction --no-progress

script:
  - phpunit
  - ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@$SSH_HOST "cd $DEPLOY_PATH && git pull && php artisan migrate:refresh --seed"
